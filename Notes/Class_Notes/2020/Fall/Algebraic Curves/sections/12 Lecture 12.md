# Lecture 12: Chapter 3, Curves Over a Finite Field

## Finiteness of Class Groups

We consider $k= \FF_q$ a finite field, which by definition is a one variable global function field.
Idea: we've defined some affine dedekind domains (the holomorphy rings) had a finite nonempty set of places of the function field.
These are analogous to the ring of integers of a number field, or more generally $S\dash$integer rings.
Recall some basic results from NT1: the finiteness of the class group, and the finite generation of the unit group.
Here we have a class groups of affine Dedekind domain, and by Rosen's theorem, there are infinitely many as you vary over nonempty subsets of places of the function field, and they're all closely connected to a geometric class group: the degree zero divisor class group.
Thus by this analogy, when the field is finite, we'd expect that $\Cl^0(K)$ is finite as well, which is the main result we'll prove today.

## Base Extension

Let $K_{/\FF_q}$ be a one variable function field with constant field $\FF_q$, so that the only elements of $K$ that are algebraic over $\FF_q$ are already in $\FF_q$.
Since $\FF_q$ is a perfect field ($x\mapsto x^p$ is a surjection), every such function field is regular.

Let $\bar{\FF}_q$ be an algebraic closure, then for all $r\in \ZZ^+$ there exists a unique degree $r$ extension, which we'll denote $\FF_{q^r}$.
The extension $\FF_{q^r}/\FF_q$ is a cyclic galois extension (i.e. it's galois group is cyclic) with a canonical generator: the Frobenius map.

The galois theory of the constant field comes in when trying to study constant extensions of the function field.
There is a general theory of constant extensions, but in our case, every such extension will be cyclic or procyclic, so we don't need the entire theory.

For any positive integer $r$, define the extension $K_r \da K \FF_{q^r}$ given by extending scalars, which is a regular function field over $\fqr$.
There are two ways to obtain this: either take an algebraic closure of $K$ and take the compositum, or take $K\tensor_{\fq}\fqr$, which we proved was again a field.
This $K_r$ is what we get by extending constants, and the way regular function fields work is that if you make an arbitrary extension of the ground field, then you retain a regular function field over this new extension.
On the other hand, note that $K_R/K$ is a degree $r$ arithmetic extension of function field, whose galois group is also generated by Frobenius.
If we take any regular function field over $k$ and then take a finite galois extension $l/k$, then extending scalars in this way would give an extension of the upstairs fields which is galois and has the same galois group as the constant extension.
This is *arithmetic* because the only thing that changes going from $K$ to $K_r$ is the field of constants.

In the analogy of function fields as the meromorphic functions on a Riemann surface, this type of extension has no analog: since $\CC$ is algebraically closed, there are no constant extensions.
So arithmetic extensions are just extending scalars, and *geometric* extensions  don't change the constant field at all and instead have the property that if you extended scalars to the algebraic closure, you'd have an extension of the same degree.
Note that the Ã©tale fundamental group also has a similar decomposition into an arithmetic part and a geometric part (see Daniel Litt's course).

### Splitting of Places

:::{.question}
Given a place in $K$, how does it split (or not) in $K_r$?
:::

:::{.remark}
We can ask this question in whenever we have an extension of function fields.
This reduces to the usual ATI type of question: for $v\in \Sigma(K/\fq)$, choose an affine Dedekind domain $R$ such that $v\in \Sigma(K/R)$, i.e. the place is regular.
Let $S$ be the integral closure of $K$ in $K_r$; this place corresponds to a maximal ideal $\mathfrak{p}$, we then want to factor its pushforward $\mathfrak{p}_v S$.
So this question is a special case of how a prime ideal factors in an extension of Dedekind domains.
:::

We'll temporarily black-box the following lemma:

:::{.lemma title="?"}
Suppose $v$ is the downstairs place, $r$ is the degree of the extension, and $d\da \deg(v)$.
Then 

- $K_r/K$ is galois and we have $efg = r$.[^residual_degree_expl]

- This extension will be unramified: we in fact have $e=1$, so $g = \gcd(d, r)$ and $f = r/\gcd(d, r)$, and

- Each place $w\in \Sigma(K_r/\fqr)$ lying over $v$ has degree $d/\gcd(d, r)$.

[^residual_degree_expl]: $e$ is the prime ramification index, $f$ is the prime residual degree, and $g$ is the number of distinct primes. 
This result essentially comes from ANTI, replacing $\sum e_i f_i = r$.

:::

:::{.remark}
Note that having an extension of Dedekind domains coming from a galois extension of fields simplifies things: this makes the inertial degree and ramification indices coincide.
:::

:::{.example title="?"}
\envlist
- The extension is inert $\iff$ $\gcd(d, r) = 1$

  - I.e. $d, r$ are coprime and $g=e=1, f=r$.

- The extension splits completely $\iff$ $r \divides d$.

  - If $r=d$, i.e. we take a degree $d$ place and extend scalars to $K_d$, it splits completely into $d$ degree 1 places.

- All $w\divides v$ have degree 1 $\iff$ $d\divides r$.

:::

:::{.remark}
Suppose we have $w$ over $v$ with $w\in \Sigma(\fqr)$ and $v\in \Sigma(K/\fq)$.
If $v$ has degree $d$, this means that the residue field satisfies $k(v) \cong \FF_{q^{d}}$, since we have unique extensions in each degree.
If $f$ is the $f$ from ANTI, it is also the degree of the residual extension, so we know $[k(w): k(v)] = f$ and thus $k(w) \cong  \FF_q^{f d}$.

On the other hand, $k(w)$ is an extension of $\fqr$ of degree $\deg(w)$, so $k(w) \cong \FF_{ \qty{q^r}^{\deg(w)} } = \FF_{q^{r\deg(w)}}$.
Thus $r=fg$ and
\[  
q^{f\deg(v)} = q^{r\deg(w)} \implies \deg(w) = \qty{f\over r}\deg(v) = { \deg(v) \over g}
.\]

The residue field, if it changes at all, can only increase in size, since any extension of Dedekind domains induces an extension of residue fields.
So the size of the residue field of $w$ is at least as big as the size of the residue field of $v$.
But the degree of $w$ is measured relative to the extended field $\fqr$, since it's the degree of the residue field as an extension of $\fqr$.
So consider $\deg(w) = \deg(v)/g$, we see that even as the residue field is increasing by a factor of $f$, the degree of the point is decreasing by a factor of $g$.

**Upshot**:
The residue field grows, but its degree can only shrink.
Thus making an extension forces the degrees of the upstairs places to *decrease*.
:::

We're trying to find out in how many ways a discrete valuation extends to a finite degree field extension.
From ANTII, we have a result that describes this: if $v$ is a rank 1 valuation on $k$ and $L/K$ is a finite degree extension, then the extensions of $v$ to $L$ correspond with $\mspec(\hat{K}_v \tensor_K L)$, where the hat denotes completing $K$ with respect to the valuation. 
The $e,f,g$ can all be computed as well.[^pete_note_164]

[^pete_note_164]: See Pete's NTII notes, Theorem 1.64.

This is some finite degree $\hat{K}_v$ algebra, and if $L/K$ is separable then this decomposes as a finite product of finite degree field extensions of $K$ and $\hat{K}_v$, the number of which will be $g$.
The $e$ and $f$ can be read off because each extension will have a ramified and unramified part.


:::{.exercise title="?"}
\envlist

a. Show that $\FF_{q^d} \tensor_{\FF_q} \FF_{q^r} \cong  \FF_{q^l}^{d'}$ where $l = \lcm(d, r)$ and $d' = \gcd(d, r)$.

b. Generalize this to the case when $k_p / k$ and $\ell / k$ are both cyclic galois extensions.

:::

## Degree 1 Places and Rational Points on a Curve


Taking the lemma as a black box, for $r\in \ZZ^+$ let $N_r \da \abs{\Sigma_1(K_r/ \fqr) }$, i.e. the number of degree 1 places of the function field after making a degree $r$ extension.
Equivalently, $N_r = \abs{C(\fqr)}$ where $C$ is a unique complete nonsingular curve over $\fq$ corresponding to $K$, and this denotes the number of $\fqr$ rational points.
We'll eventually see these are finite.

:::{.remark}
Important way of thinking about these: degree one places of a function field over $k$ correspond to $k\dash$rational points of a curve.
:::

:::{.corollary title="Equivalence of data: places and rational points"}
\[  
N_r = \sum_{d\divides r} d\cdot \abs{\Sigma_d(K/ \fq)}
,\]
so knowing the number of closed points of each degree is equivalent to knowing the $\fqr\dash$points for all $r$.
:::

:::{.proof title="?"}
Let $w\in \Sigma_1(K_r/\fqr)$ be a degree 1 point and set $v \da w\intersect K$ so $w$ lies over $v$.
What is the degree of $v$?
Setting $d \da \deg(v)$, the lemma gives 
\[  
1 = \deg(w) = {d\over \gcd(d, r)}
,\]
which implies that $\gcd(d, r) = d$ and thus $d\divides r$.
So for each $d$ dividing $r$, every degree of $v\in \Sigma(K/\fq)$ contributes $\gcd(d, r) = d$ degree 1 points on $K_r$, i.e. every downstairs degree $d$ place splits into $d$ degree one places.
So for every such $d$, every degree $d$ closed point contributes $d$ degree 1 closed points lying above it, and conversely if $d$ does not divide $r$ then the upstairs point would not have degree 1, so this accounts for all of the degree 1 points.
:::

:::{.remark}
We saw that the degree 1 places and the rational points are the same information, and there is a third equivalently quantity: $A_n$, defined to be the number of effective divisors of degree $n$.
:::

## Finiteness of Places and Rational Points

:::{.lemma title="?"}
\envlist

a. For all $d$, the number of degree $d$ closed points $\Sigma_d(K/\fq)$ is finite (and therefore $N_r$ is finite), and

b. For all $n$, $A_n$ is finite.
:::

:::{.proof title="of a"}
Let $L/K$ be a degree $n$ extension of regular function fields over $\fq$.
We then have a restriction map
\[  
r: \Sigma(L/\fq) \surjects \Sigma(K/\fq)
\]
which we showed is surjective with finite fibers.
We can say a little bit more: for all places $w \in \Sigma(L/\fq)$, we have an inequality
\[  
\qty{1\over n}\deg(w) \leq \deg(r(w)) \leq \deg(w)
,\]
noting that we're now measuring all degrees over a common ground field $\fq$.
So things are now what you'd expect: the degree of the upstairs point is a multiple of the degree of the downstairs point.
The upper bound comes from the fact that the residue of the upstairs point is a finite extension of the residue field of the downstairs points.
The opposite inequality comes from ANTI: the degree of the residual extension is at most the degree of the entire extension.

So $r$ doesn't preserve degrees exactly, but preserves them up to a bounded factor, and thus $\Sigma_{\leq d}(L/\fq)$ is finite for all $d$ $\iff$ $\Sigma_{\leq d}(K/\fq)$ is finite for all $d$.
Because of this, we can reduce the situation by exchanging the function field $L/\fq$ with any other function field for which $L$ is a finite extension, and in particular we can take the rational function field $K = \FF_q(t)$.
What are the degree $d$ places of a rational function field?
There is exactly one place at infinity, and the remaining ones correspond to monic irreducible polynomials.
Since $\fq$ is finite, there are only finitely many such polynomials of any fixed degree.[^exact_formula]

[^exact_formula]: There is an exact formula for this quantity.

:::

:::{.proof title="of b"}
Left as an exercise.

Some remarks: how do you build an effective divisor of degree $n$?
Take closed points (places) and start adding them up with positive coefficients, then the degree of the divisor is the sum of the degrees of the places.
But if you only have finitely many places, each of which can only be used a bounded number of times (certainly no more than $n$ times!), thus one can only build finitely many effective divisors of each degree.
:::

## Finiteness of Class Group


:::{.proposition title="Finiteness of class group"}
The degree 0 divisor class group $\Cl^0(K)$ is finite.
:::

This is a geometric analog of the finiteness of the class group of the ring of integers of a number field.
By Rosen's theorem, as an immediate corollary, the class group of any affine dedekind domain over a finite ground field is finite.
This follows from looking at the exact sequence: a finite index subgroup of the class group of any dedekind domain is a quotient of $\Cl^0(K)$, and a finite index subgroup of a finite group is finite.

:::{.proof title="?"}
Set $\delta \da I(K)$ to be the index, i.e. the least possible degree of a divisor.[^Shmidt_theorem]

[^Shmidt_theorem]: 
By a theorem of Schmidt, we'll later prove that $\delta = 1$.

In any case, for all $n\in \ZZ$, we have
\[  
\Cl^n K = 
\begin{cases}
0 & \delta\notdivides n \\
\abs{\Cl^0 K} & \delta\divides n
\end{cases}
.\]
If you have any degree $n$ divisors, then $\Cl^n K$ will be a coset of $\Cl^0 K$.
Here we just look at the degree map, which is a group morphism onto its image, of which all nonempty fibers have the same size.
Thus we may work with $\Cl^n K$ for $n\gg 0$.
\

In particular, choose $n\geq g$ the genus such that $\delta \divides n$, and let $D \in \Div^n K$.
A Riemann-Roch computation shows that $\ell(D)$, the dimension of the linear system, is at least $n-g+1$, and so we have $\ell(D) \geq 1$ and $D$ is linearly equivalent to an effective divisor.
This shows that the map taking effective degree $n$ divisors to $\Cl^n K$ taking a divisor to its divisor class (restricted to effective divisors) is surjective.
But we just saw that the set of effective degree $n$ divisors is finite -- it was built out of finitely many closed points of bounded degrees -- forcing $\Cl^n K$ to be finite.
The result follows because $\Cl^n K$ is a coset of $\Cl^0 K$, all of which have the same size, and the index is finite.
:::

:::{.definition title="Class Number of $K$"}
The **class number** of $K$ is defined as
\[  
h \da \abs{\Cl^0 K}
.\]
:::

:::{.remark}
There is a much fancier proof: there exists a $g\dash$dimensional abelian variety $A / \FF_q$, the *Jacobian variety* of $C/\FF_q$, such that $\Cl^0 K + A(\FF_q)$.
It is built out of the degree 0 divisor class group in some functorial way.
In particular, $A$ is a projective variety, and thus embeds into some $\PP^N_{/\FF_q}$, and so $\abs{A(\FF_q)} \leq \abs{\PP^N_{/\FF_q}} < \aleph_0$.
\

As one varies over all function fields over all finite fields, there will only be finitely many whose class number is bounded by some fixed $h_0$.
E.g. there are only finitely many function fields of class number 1, and these can be explicitly listed.
So $h\to \infty$ in some sense, which is not proved by showing that $\abs{A(\fq)} \to \infty$, and we'll instead prove it using methods closer to what we're seeing in this course.
:::

Up next: setting up the zeta function.
