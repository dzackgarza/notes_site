# Stalks and Localizations (Thursday, October 01)


## Review

Recall that a sheaf of rings on a topological space $X$ is a ring $\mathcal{F}(U)$ for all open sets $U\subset X$ satisfying four properties:

1. Initial to terminal: the empty set is mapped to zero.[^initial_and_terminal_sets_rings]

[^initial_and_terminal_sets_rings]: 
The initial object in the category of Sets is the empty set, and the terminal object in the category of Rings is the zero ring.
This "swap" comes from the fact that presheaves should be contravariant.


2. Identities: the morphism $\mathcal{F}(U)\to \mathcal{F}(U)$ is the identity.

3. Composition: given $W\subset V\subset U$ we have a commutative diagram
\begin{center}
\begin{tikzcd}
\mathcal{F}(U) \ar[rr, "\Res_{UV}"] \ar[rd, "\Res_{UW}"'] &                & \mathcal{F}(V) \ar[ld, "\Res_{VW}"] \\
                       & \mathcal{F}(W) &
\end{tikzcd}
\end{center}

4. Gluing: given sections $s_i \in\mathcal{F}(U_i)$ which agree on overlaps (restrict to the same function on $U_i\intersect U_j$), there is a unique $s\in \mathcal{F}(\union U_i)$.

:::{.example}
If $X$ is an affine variety with the Zariski topology, $\mathcal{O}_X$ is a sheaf of regular functions, where we recall $\mathcal{O}_X(U)$ are the functions $\phi: U\to k$ that are locally a fraction.
:::


## Computing Stalks 

Recall that the **stalk** of a sheaf $\mathcal{F}$ at a point $p\in X$, is defined as 
\[  
\mathcal{F}_p \da \ts{(U, \phi) \st p\in U \text{ open },\, \phi \in \mathcal{F}(U)}/\sim
.\]
where $(U, \phi) \sim (U', \phi')$ if there exists a $p\in W \subset U\intersect U'$ such $\phi, \phi'$ restricted to $W$ are equal.

Recall that a **local ring** is a ring with a unique maximal ideal $\mfm$.
Given a prime ideal $\mfp \in R$, so $ab\in \mfp \implies a,b\in \mfp$, the complement $R\setminus P$ is closed under multiplication.
So we can localize to obtain 
\[
R_\mfp &\da \ts{a/s \st s\in R\setminus P, a\in R}/\sim \\
\text{ where } a'/s' \sim a/s &\iff \exists t\in R\sm P \text{ such that } t(a's - as') = 0
\]

:::{.warnings title="Notation for localizations"}
Note that $R_f$ is localizing at the powers of $f$, whereas $R_\mfp$ is localizing at the *complement* of $\mfp$.
:::

Since maximal ideals are prime, we can localize any ring $R$ at a maximal ideal $\mathfrak{m} \in \mspec(R)$ to obtain $R_\mfm$, and this will be a local ring.
Why?
The ideals in $R_\mfm$ biject with ideals in $R$ contained in $\mfm$.
Thus all ideals in $R_\mfm$ are contained in the maximal ideal generated by $\mfm$, i.e. $\mfm R_\mfm$.


:::{.lemma title="Stalks are isomorphic to localizations"}
Let $X$ be an affine variety, then
\[  
\OO_{X, p}\da \qty{\OO_X}_p \cong A(X)_{\mathfrak{m}_p}
.\]
In words: the stalk of the sheaf of regular functions $\OO_{X, p} \da (\OO_X)_p$ is isomorphic to the localization $A(X)_{\mfm_p}$ where $\mfm_p \da I(\ts{p})$.
:::

:::{.proof}
We can write
\[  
A(X)_{\mfm_p} \da \ts{{g\over f} \st g\in A(X),\, f\in A(X)\sm \mfm_p} / \sim \\
\text{ where } g_1/f_1 \sim g_2/f_2 \iff \exists h(p) \neq 0 \text{ where }0 = h(f_2 g_1 - f_1 g_2)
.\]
where the $f$ are regular functions on $X$ such that $f(p) = 0$.

We can also write
\[  
\OO_{X, p} \da \ts{(U, \phi) \st p\in U,\, \phi \in \OO_X(U) } /\sim 
\\ \text{ where } (U, \phi) \sim (U', \phi') 
\iff \exists p\in W \subset U\intersect U' \text{ s.t. } \ro{\phi}{W} = \ro{\phi'}{W}
.\]

So we can define a map
\[  
\Phi: A(X)_{\mfm_p} &\to \OO_{X, p} \\
{g\over f} &\mapsto \qty{D_f, {g\over f}}
.\]

**Step 1:**
There are equivalence relations on both sides, so we need to check that things are well-defined.

We have
\[  
g/f \sim g'/f' &\iff \exists g \text{ such that } h(p) \neq 0,\, h(gf' - g'f)=0 \in A(X) \\
&\iff \text{the functions } {g\over f}, {g' \over f'} \text{ agree on } W\da D(f) \intersect D(f') \intersect D(h) \\
&\implies (D_f, g/f) \sim (D_{f'}, g'/f')
,\]
since there exists a $W\subset D_f \intersect D_{f'}$ such that $g/f, g'/f'$ are equal.
\

**Step 2:**
Surjectivity, since this is clearly a ring map with pointwise operations.

Any germ can be represented by $(U, \phi)$ with $\phi \in \OO_X(U)$.
Since the sets $D_f$ form a base for the topology, there exists a $D_f\subset U$ containing $p$.
By definition, $(U, \phi) = (D_f, \ro{\phi}{D_f})$ in $\OO_{X, p}$.

Using the proposition that $\OO_X(D(f)) = A(X)_f$, this implies that $\ro{\phi}{D_f} = g/f^n$ for some $n$ and $f(p) \neq 0$, so $(U, \phi)$ is in the image of $\Phi$.
\

**Step 3**:
Injectivity.
We want to show that $g/f\mapsto 0$ implies that $g/f = 0 \in A(X)_{\mfm_p}$.

Suppose that $(D_f, g/f) = 0 \in \OO_{X, p}$ and $(U, \phi) = 0 \in \OO_{X,p}$, then there exists an open $W\subset D_f$ containing $p$ such that after passing to some distinguished open $D_h\ni p$ such that $\phi = 0$ on $D_h$.
Wlog we can assume $\phi = 0$ on $U$, since we could shrink $U$ (staying in the same equivalence class) to make this true otherwise.
Then $\phi = g/f$ on $D_h$, using that $\OO_X(D_f) = A(X)_f$, so $g/f = 0$ here.
So there exists a $k$ such that 
\[  
f^k(g\cdot 1 - 0\cdot f) = 0 \in A(X) \implies f^k g=0 \in A(X)_{\mfm_p}
.\]

We can thus conclude that
\[  
\OO_{X, p} \cong A(X)_{\mfm_p}
.\]

:::


:::{.example}
Let $X = \ts{p, q}$ with the discrete topology with the sheaf $\mathcal{F}$ given by 
\[  
p &\mapsto R \\
q &\mapsto S \\
X &\mapsto R\cross S
.\]
Then $\mathcal{F}_p = R$, since if $U$ is open and $p\in\ U$ then either $U= \ts{p}$ or $U = X$.
We can check that for $(r, s)$ a section of $\mathcal{F}$, we have an equivalence of germs 
\[
(X, (r, s)) \sim (\ts{p}, r) \text{ since } \ts p \subset X\intersect \ts p
\]
Here $X$ plays the role of $U$, $\ts p$ of $U'$, and the last $\ts p$ the role of $W \subset U\intersect U'$.

\[  
\OO_{X, p} &\to A(X) \\
(\ts{p}, r) &\mapsto r \\
\mathcal{F}_p &\cong R
.\]
:::

:::{.example}
Let $M$ be a manifold and consider the sheaf $C^\infty$ of smooth functions on $M$.
Then the stalk $C_p^\infty$ at $p$ is defined as the set of smooth functions in a neighborhood of $p$ modulo functions being equivalent if they agree on a small enough ball $B_\eps(p)$.
This contains a maximal ideal $\mfm_p$, the smooth functions vanishing at $p$.
Then $\mfm_p^2$ is again an ideal, and as sets,
\[  
\mfm^2 = \ts{f \st \del_i \del_j f\mid_p = 0,\, \forall i,j}
.\]
Thus $\mfm_p/\mfm_p^2 \cong \ts{\del_v}\dual$, the *dual* of the set of directional derivatives.
:::

## Morphisms of Affine Varieties

Problem: what should a map of affine varieties be?
A bad definition would be just taking the continuous maps: for example, any bijection $\AA^1_{_\CC}$ is a homeomorphism in the Zariski topology.
Why? 
This coincides with the cofinite topology, and the preimage of a cofinite set is cofinite.

:::{.question}
How do we fix this?
:::

:::{.answer}
\envlist

1. $f:X\to Y$ should be continuous, i.e. $f^{-1} (U)$ is open whenever $U$ is open.

2. Given $U\subset Y$ open and $\phi \in \OO_Y(U)$, the function $\phi \circ f: f^{-1}(U) \to k$ should be regular.

We'll take these conditions to be the definition of a morphism $X\to Y$.
:::


:::{.example}
For smooth manifolds, we similarly require that there is a pullback that preserves smooth functions:
\[  
f^*: C^\infty(U) \to C^\infty(f^{-1}(U))
.\]
:::

